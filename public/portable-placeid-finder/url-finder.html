<!DOCTYPE html>
<!--
 @license
 Copyright 2024 Google LLC. All Rights Reserved.
 SPDX-License-Identifier: Apache-2.0
-->
<html>

<head>
    <title>URL to Place ID Finder</title>
    <link rel="stylesheet" type="text/css" href="./style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Use the same loader as index.html -->
    <script>(g => { var h, a, k, p = "The Google Maps JavaScript API", c = "google", l = "importLibrary", q = "__ib__", m = document, b = window; b = b[c] || (b[c] = {}); var d = b.maps || (b.maps = {}), r = new Set, e = new URLSearchParams, u = () => h || (h = new Promise(async (f, n) => { await (a = m.createElement("script")); e.set("libraries", [...r] + ""); for (k in g) e.set(k.replace(/[A-Z]/g, t => "_" + t[0].toLowerCase()), g[k]); e.set("callback", c + ".maps." + q); a.src = `https://maps.${c}apis.com/maps/api/js?` + e; d[q] = f; a.onerror = () => h = n(Error(p + " could not load.")); a.nonce = m.querySelector("script[nonce]")?.nonce || ""; m.head.append(a) })); d[l] ? console.warn(p + " only loads once. Ignoring:", g) : d[l] = (f, ...n) => r.add(f) && u().then(() => d[l](f, ...n)) })
            ({ key: "AIzaSyA6myHzS10YXdcazAFalmXvDkrYCp5cLc8", v: "weekly" });</script>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <div>
            <h1>URL to Place ID Finder</h1>
            <p class="subtitle">Paste a full Google Maps URL below to find its Place ID.</p>
        </div>

        <!-- Input Section -->
        <div class="input-group">
            <input type="text" id="urlInput" placeholder="https://www.google.com/maps/place/..." />
            <button class="btn btn-primary" onclick="findPlace()">
                <span>Find Place ID</span>
            </button>
        </div>

        <!-- Feedback -->
        <div id="error" class="error"></div>

        <!-- Result Card -->
        <div id="result">
            <div class="result-item">
                <span class="label">Place Name</span>
                <span id="placeName" class="value" style="font-weight: 600;"></span>
            </div>

            <div class="result-item">
                <span class="label">Place ID</span>
                <div style="display: flex; gap: 8px; align-items: center;">
                    <span id="placeId" class="value mono"></span>
                    <button class="btn btn-ghost" onclick="copyPlaceId()" title="Copy Place ID"
                        style="padding: 4px 8px;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <div class="result-item">
                <span class="label">Address</span>
                <span id="placeAddress" class="value"></span>
            </div>
        </div>
    </div>

    <script>
        // Initialize API - No explicit init needed for Place class usage in this simple flow
        // init();

        async function findPlace() {
            const urlInput = document.getElementById('urlInput').value.trim();
            const errorDiv = document.getElementById('error');
            const resultDiv = document.getElementById('result');
            const btn = document.querySelector('button.btn-primary');

            errorDiv.style.display = 'none';
            resultDiv.style.display = 'none';
            btn.innerHTML = '<span>Searching...</span>';
            btn.disabled = true;

            if (!urlInput) {
                showError('Please enter a URL');
                resetBtn();
                return;
            }

            // parse URL
            let query = '';
            try {
                // Start simple: try to extract /place/<NAME>/
                const regex = /\/maps\/place\/([^\/@]+)/;
                const match = urlInput.match(regex);

                if (match && match[1]) {
                    query = decodeURIComponent(match[1].replace(/\+/g, ' '));
                } else {
                    showError('Could not extract place name from URL. Ensure it is a full "google.com/maps/place/..." link.');
                    resetBtn();
                    return;
                }
            } catch (e) {
                showError('Error parsing URL.');
                resetBtn();
                return;
            }

            if (!query) {
                showError('Could not extract place name.');
                resetBtn();
                return;
            }

            console.log("Searching for:", query);

            try {
                // Use the new Place class for search
                // @ts-ignore
                const { Place } = await google.maps.importLibrary("places");

                const request = {
                    textQuery: query,
                    fields: ['displayName', 'id', 'formattedAddress'], // New field names
                };

                const { places } = await Place.searchByText(request);

                if (places && places.length > 0) {
                    const place = places[0];
                    document.getElementById('placeName').textContent = place.displayName;
                    document.getElementById('placeId').textContent = place.id;
                    document.getElementById('placeAddress').textContent = place.formattedAddress;
                    resultDiv.style.display = 'block';
                } else {
                    showError('Place not found using extracted name: "' + query + '".');
                }
            } catch (error) {
                console.error("Place search error:", error);
                showError('Error searching for place: ' + (error.message || error));
            } finally {
                resetBtn();
            }
        }

        function showError(msg) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = msg;
            errorDiv.style.display = 'block';
        }

        function resetBtn() {
            const btn = document.querySelector('button.btn-primary');
            btn.innerHTML = '<span>Find Place ID</span>';
            btn.disabled = false;
        }

        function copyPlaceId() {
            const placeId = document.getElementById('placeId').textContent;
            navigator.clipboard.writeText(placeId).then(() => {
                const btn = document.querySelector('button[title="Copy Place ID"]');
                const originalContent = btn.innerHTML;

                // Show checkmark
                btn.innerHTML = `
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                `;

                setTimeout(() => {
                    btn.innerHTML = originalContent;
                }, 2000);
            });
        }
    </script>
</body>

</html>